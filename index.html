<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sky Flappy â€” Game HTML5 (Single File)</title>
  <style>
    :root{--bg1:#6ec1ff;--bg2:#e0f2ff;--dark:#0b1220;--ui:#0ea5e9;--danger:#ef4444;--ok:#10b981}
    *{box-sizing:border-box}body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--bg1),var(--bg2));font-family:Inter,system-ui,Arial;color:#0b1220}
    .wrap{width:100%;max-width:480px;padding:10px}
    .panel{background:rgba(255,255,255,0.65);backdrop-filter: blur(6px);border-radius:14px;box-shadow:0 10px 30px rgba(2,6,23,.25);padding:10px}
    canvas{width:100%;height:auto;display:block;border-radius:10px;background:linear-gradient(180deg,#87ceeb,#cdefff)}
    .row{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:8px}
    .btn{padding:8px 12px;border:0;border-radius:10px;background:#111827;color:#fff;cursor:pointer}
    .btn.primary{background:var(--ui)}
    .btn.danger{background:var(--danger)}
    .stats{display:flex;gap:8px}
    .tag{background:#ffffff99;padding:6px 10px;border-radius:10px;font-weight:700}
    .small{font-size:12px;opacity:.7}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <canvas id="game" width="480" height="640" aria-label="Sky Flappy"></canvas>
      <div class="row">
        <div class="stats">
          <div class="tag">Skor: <span id="score">0</span></div>
          <div class="tag">High: <span id="high">0</span></div>
        </div>
        <div class="row" style="gap:6px">
          <select id="difficulty" class="btn">
            <option value="easy">Easy</option>
            <option value="normal" selected>Normal</option>
            <option value="hard">Hard</option>
          </select>
          <button id="start" class="btn primary">Mulai</button>
          <button id="reset" class="btn danger">Reset</button>
        </div>
      </div>
      <div class="small" style="margin-top:6px">Kontrol: Klik/Tap layar atau tombol Spasi untuk melompat. Hindari pipa, kumpulkan bintang, dan pecahkan rekor! ðŸŽ®</div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('start');
    const resetBtn = document.getElementById('reset');
    const scoreEl = document.getElementById('score');
    const highEl = document.getElementById('high');
    const diffSel = document.getElementById('difficulty');

    const W = canvas.width, H = canvas.height;
    let gameState = 'ready'; // ready | playing | over
    let last = 0;
    let score = 0; let high = parseInt(localStorage.getItem('flappy.high')||'0',10); highEl.textContent = high;

    // difficulty params
    const DIFF = {
      easy:   {gap: 200, speed: 150, gravity: 900, jump: 280, spawn: 1.4},
      normal: {gap: 170, speed: 200, gravity: 990, jump: 300, spawn: 1.25},
      hard:   {gap: 120, speed: 210, gravity: 1050, jump: 320, spawn: 1.1},
    };

    // simple sfx (beep) via WebAudio
    const AudioCtx = window.AudioContext||window.webkitAudioContext; let actx=null;
    function beep(freq=600, dur=0.07, type='sine', vol=0.05){
      if(!actx) return; const o=actx.createOscillator(); const g=actx.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=vol; o.connect(g).connect(actx.destination); o.start(); o.stop(actx.currentTime+dur);
    }

    // Entities
    class Bird{
      constructor(){ this.reset(); }
      reset(){ this.x=120; this.y=H/2; this.vy=0; this.r=14; this.rot=0; }
      update(dt){ this.vy += params.gravity*dt; this.y += this.vy*dt; this.rot = Math.atan2(this.vy, 300);
        // floor/ceiling
        if(this.y > H-40){ this.y = H-40; this.vy = 0; die(); }
        if(this.y < 20){ this.y = 20; this.vy = 0; }
      }
      jump(){ this.vy = -params.jump; spawnFeathers(); beep(700,0.06,'triangle',0.06); }
      draw(){
        const x=this.x,y=this.y,r=this.r;
        ctx.save(); ctx.translate(x,y); ctx.rotate(this.rot);
        // body
        ctx.fillStyle = '#ffd166'; roundRect(ctx,-r,-r,r*2,r*2,8); ctx.fill();
        // wing
        ctx.fillStyle = '#fca311'; ctx.beginPath(); ctx.ellipse(-4, 0, 10,6, 0, 0, Math.PI*2); ctx.fill();
        // eye
        ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(6,-6,5,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#111'; ctx.beginPath(); ctx.arc(7,-6,2.2,0,Math.PI*2); ctx.fill();
        // beak
        ctx.fillStyle='#ff6b6b'; ctx.beginPath(); ctx.moveTo(r-4,-2); ctx.lineTo(r+8,0); ctx.lineTo(r-4,2); ctx.closePath(); ctx.fill();
        ctx.restore();
      }
    }

    class PipePair{
      constructor(x){ this.x=x; this.w=70; this.passed=false; this.resetHeights(); }
      resetHeights(){ const gap=params.gap; const minTop=40; const maxTop=H-140-gap; this.top= minTop + Math.random()*maxTop; this.bottom = this.top + gap; }
      update(dt){ this.x -= params.speed*dt; if(this.x + this.w < 0){ this.x = W + 160; this.passed=false; this.resetHeights(); }
        // score when bird passes center
        if(!this.passed && this.x + this.w < bird.x){ this.passed=true; score++; scoreEl.textContent=score; beep(450,0.05,'square',0.03); if(score>high){ high=score; localStorage.setItem('flappy.high',String(high)); highEl.textContent=high; }
        // occasional star
        if(Math.random()<0.35) stars.push(new Star(this.x+this.w+10, rand(this.top+20,this.bottom-20))); }
      }
      draw(){ ctx.fillStyle = '#3cb371'; // pipes
        // top pipe
        ctx.fillRect(this.x, 0, this.w, this.top);
        ctx.fillRect(this.x-8, this.top-20, this.w+16, 20);
        // bottom pipe
        ctx.fillRect(this.x, this.bottom, this.w, H-this.bottom);
        ctx.fillRect(this.x-8, this.bottom, this.w+16, 20);
      }
      collide(b){ // AABB circle collision
        const cx=b.x, cy=b.y, r=b.r; // top rects
        if(circleRect(cx,cy,r, this.x,0,this.w,this.top)) return true;
        if(circleRect(cx,cy,r, this.x,this.bottom,this.w,H-this.bottom)) return true; return false;
      }
    }

    class Star{ // bonus item between pipes
      constructor(x,y){ this.x=x; this.y=y; this.r=6; this.alive=true; }
      update(dt){ this.x -= params.speed*dt; if(this.x<-20) this.alive=false; if(Math.hypot(this.x-bird.x, this.y-bird.y) < this.r + bird.r){ this.alive=false; score+=2; scoreEl.textContent=score; sparkle(this.x,this.y); beep(880,0.06,'sine',0.05); if(score>high){ high=score; localStorage.setItem('flappy.high',String(high)); highEl.textContent=high; } } }
      draw(){ drawStar(this.x,this.y,this.r,5,2.5,'#ffe45e'); }
    }

    // particles
    const feathers=[]; const sparks=[];
    function spawnFeathers(){ for(let i=0;i<8;i++){ feathers.push({x:bird.x-6,y:bird.y, vx:-80+Math.random()*-20, vy:(Math.random()*2-1)*80, life:0.5}); } }
    function sparkle(x,y){ for(let i=0;i<12;i++){ const a=Math.random()*Math.PI*2; const s=70+Math.random()*120; sparks.push({x,y, vx:Math.cos(a)*s, vy:Math.sin(a)*s, life:0.4}); } }

    // helpers
    function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
    function circleRect(cx,cy,r, rx,ry,rw,rh){ const nx = Math.max(rx, Math.min(cx, rx+rw)); const ny = Math.max(ry, Math.min(cy, ry+rh)); const dx=cx-nx, dy=cy-ny; return dx*dx+dy*dy < r*r; }
    function rand(a,b){ return a + Math.random()*(b-a); }

    // world
    let params = DIFF[diffSel.value];
    let bird = new Bird();
    let pipes = [new PipePair(W+100), new PipePair(W+360), new PipePair(W+620)];
    let stars = [];

    // background parallax
    const clouds = Array.from({length:6}, _ => ({x:rand(0,W), y:rand(30,260), s:rand(10,30)}));
    let dayTime = 0; // day-night cycle

    function reset(){ score=0; scoreEl.textContent=score; params = DIFF[diffSel.value]; bird.reset(); pipes=[new PipePair(W+100), new PipePair(W+360), new PipePair(W+620)]; stars=[]; feathers.length=0; sparks.length=0; dayTime=0; }

    function die(){ if(gameState !== 'playing') return; gameState='over'; beep(180,0.2,'sawtooth',0.06); }

    function flap(){ if(gameState==='ready'){ startGame(); } if(gameState==='playing'){ bird.jump(); } if(gameState==='over'){ reset(); startGame(); } }

    function startGame(){ if(!actx) { try{ actx = new AudioCtx(); }catch{} } gameState='playing'; last = performance.now(); requestAnimationFrame(loop); }

    // input
    canvas.addEventListener('pointerdown', flap);
    window.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); flap(); } });
    startBtn.addEventListener('click', ()=>{ if(gameState!=='playing') { if(gameState==='over') reset(); startGame(); }});
    resetBtn.addEventListener('click', ()=>{ reset(); gameState='ready'; draw(0,true); });
    diffSel.addEventListener('change', ()=>{ reset(); draw(0,true); });

    // main loop
    function loop(ts){ if(gameState!=='playing') return; const dt = Math.min(0.033, (ts-last)/1000); last = ts; update(dt); draw(dt); requestAnimationFrame(loop); }

    function update(dt){ dayTime += dt*0.5; if(dayTime>Math.PI*2) dayTime=0;
      // bg clouds
      for(const c of clouds){ c.x -= (20 + c.s*0.6)*dt; if(c.x < -50) { c.x = W+50; c.y = rand(20, 260); } }
      // bird
      bird.update(dt);
      // pipes & stars
      for(const p of pipes) p.update(dt);
      for(const s of stars) s.update(dt);
      stars = stars.filter(s=>s.alive);
      // particles
      for(const f of feathers){ f.x += f.vx*dt; f.y += f.vy*dt; f.life -= dt; }
      for(const sp of sparks){ sp.x += sp.vx*dt; sp.y += sp.vy*dt; sp.life -= dt; }
      // collisions
      for(const p of pipes){ if(p.collide(bird)) { die(); break; } }
    }

    function draw(dt, staticOnly=false){
      // sky gradient changes (day-night)
      const k = (Math.sin(dayTime)+1)/2; const top = lerpColor([135,206,235],[7,16,32], k*0.5); const bot = lerpColor([205,239,255],[4,10,22], k*0.5);
      const grad = ctx.createLinearGradient(0,0,0,H); grad.addColorStop(0, rgb(top)); grad.addColorStop(1, rgb(bot)); ctx.fillStyle = grad; ctx.fillRect(0,0,W,H);

      // clouds
      ctx.fillStyle='rgba(255,255,255,0.9)'; for(const c of clouds){ drawCloud(c.x,c.y, c.s); }

      // ground
      ctx.fillStyle = '#87a97e'; ctx.fillRect(0,H-40,W,40);
      ctx.fillStyle = '#6c8d62'; for(let x=0;x<W;x+=24){ ctx.fillRect(x,H-40,16,6); }

      // pipes
      for(const p of pipes) p.draw();
      // stars
      for(const s of stars) s.draw();
      // particles
      for(const f of feathers){ if(f.life>0){ ctx.globalAlpha = Math.max(0,f.life*2); ctx.fillStyle = '#ffe8a3'; ctx.fillRect(f.x,f.y,3,2); ctx.globalAlpha=1; } }
      for(const sp of sparks){ if(sp.life>0){ ctx.globalAlpha = Math.max(0,sp.life*2); ctx.fillStyle = '#fff'; ctx.fillRect(sp.x,sp.y,2,2); ctx.globalAlpha=1; } }

      // bird
      bird.draw();

      // overlay states
      if(gameState==='ready'){ drawBanner('KLIK / SPASI untuk mulai'); }
      if(gameState==='over'){ drawBanner('UDAH BOT BEGO MATI LAGI  '); }
    }

    function drawBanner(text){ ctx.save(); ctx.fillStyle='rgba(0,0,0,0.4)'; ctx.fillRect(0,0,W,H); ctx.translate(W/2, H/2 - 20); ctx.textAlign='center'; ctx.fillStyle='#fff'; ctx.font='700 24px Inter, Arial'; ctx.fillText(text, 0, 0); ctx.font='14px Inter, Arial'; ctx.fillText('Ubah tingkat kesulitan di pojok kanan âžœ', 0, 28); ctx.restore(); }

    function drawCloud(x,y,s){ ctx.beginPath(); ctx.arc(x, y, s, 0, Math.PI*2); ctx.arc(x+s*0.9, y+4, s*0.8, 0, Math.PI*2); ctx.arc(x-s*0.7, y+6, s*0.7, 0, Math.PI*2); ctx.fill(); }
    function drawStar(x,y,r,spikes,inner, color){ let rot=Math.PI/2*3; let cx=x; let cy=y; let step=Math.PI/spikes; ctx.beginPath(); ctx.moveTo(cx, cy-r); for(let i=0;i<spikes;i++){ cx=x+Math.cos(rot)*r; cy=y+Math.sin(rot)*r; ctx.lineTo(cx,cy); rot+=step; cx=x+Math.cos(rot)*inner; cy=y+Math.sin(rot)*inner; ctx.lineTo(cx,cy); rot+=step; } ctx.lineTo(x, y-r); ctx.closePath(); ctx.fillStyle=color; ctx.fill(); }
    function lerp(a,b,t){ return a+(b-a)*t; }
    function lerpColor(c1,c2,t){ return [Math.round(lerp(c1[0],c2[0],t)), Math.round(lerp(c1[1],c2[1],t)), Math.round(lerp(c1[2],c2[2],t))]; }
    function rgb(arr){ return `rgb(${arr[0]},${arr[1]},${arr[2]})`; }

    // Initial static frame
    reset(); draw(0,true);
  </script>
</body>
</html>
